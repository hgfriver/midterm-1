import numpy as np
import serial
import time

waitTime = 0.1

# generate the song
song = np.array([
  #Twinkle Twinkle Little Star
  0.261, 0.261, 0.392, 0.392, 0.440, 0.440, 0.392, 0.349, 0.349, 0.330, 0.330, 0.294, 0.294, 0.261, 0.392, 0.392, 0.349, 0.349, 0.330, 0.330, 0.294, 0.392, 0.392, 0.349, 0.349, 0.330, 0.330, 0.294, 0.261, 0.261, 0.392, 0.392, 0.440, 0.440, 0.392, 0.349, 0.349, 0.330, 0.330, 0.294,           
  #Two-Tiger Run Fast
  0.524, 0.588, 0.660, 0.524, 0.524, 0.588, 0.660, 0.524, 0.660, 0.698, 0.784, 0.660, 0.698, 0.784, 0.784, 0.880, 0.784, 0.698, 0.660, 0.524, 0.784, 0.880, 0.784, 0.698, 0.660, 0.524, 0.588, 0.392, 0.524, 0.588, 0.392, 0.524, 0.524, 0.588, 0.660, 0.524, 0.524, 0.588, 0.660, 0.524,                
  #Little Bee
  0.392, 0.330, 0.330, 0.349, 0.294, 0.294, 0.262, 0.294, 0.300, 0.349, 0.392, 0.392, 0.392, 0.392, 0.330, 0.330, 0.349, 0.294, 0.294, 0.262, 0.330, 0.392, 0.392, 0.330, 0.392, 0.330, 0.330, 0.349, 0.294, 0.294, 0.262, 0.294, 0.300, 0.349, 0.392, 0.392, 0.392, 0.392, 0.330, 0.330])               
noteLength = np.array([
  #Twinkle Twinkle Little Star
  0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001,                     
  #Two-Tiger Run Fast
  0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001,                        
  #Little Bee
  0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.002, 0.001, 0.001, 0.002])

# output formatter
formatter = lambda x: "%.3f" % x

# send the song to K66F
serdev = '/dev/ttyACM0'
s = serial.Serial(serdev)
print("Sending songs ...")
print("It may take about %d seconds ..." % (int(np.size(song) * waitTime)))
for data1 in song:
  s.write(bytes(formatter(data1), 'UTF-8'))
  time.sleep(waitTime)
for data2 in noteLength:
  s.write(bytes(formatter(data2), 'UTF-8'))
  time.sleep(waitTime)
s.close()
print("Songs sended")